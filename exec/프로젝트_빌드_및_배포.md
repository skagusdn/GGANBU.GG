# ğŸ› í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ë°°í¬

## âš™ì‹œìŠ¤í…œ í™˜ê²½ ë° êµ¬ì„±

- OS: Windows10, Linux
- Backend Framework: Spring Boot 2.7.1
- Frontend Framework: NextJS 12.2.5
- DB: mongoDB version v6.0.1, mysql Ver 8.0.30-0ubuntu0.20.04.2 for Linux on x86_64 ((Ubuntu))
- WAS: Gradle
- JVM: javac 1.8.0_342
- Node.js: 16.16.0
- npm: 8.19.1
- Docker: 20.10.12
- Jenkins: 2.361.1
- WEB: Nginx (1.18.0)

<br/><br/><br/>

## DB ì ‘ì† ì •ë³´ ë° í”„ë¡œí¼í‹°
### Database ì ‘ê·¼

> ID: j7c204

> PW: seveneleven

<br/><br/><br/>

## EC2ì— DB ì„¤ì¹˜ ë° ì„¸íŒ…

### MongoDB ì„¤ì¹˜ ë° ì„¸íŒ…
```shell
# ì„¤ì¹˜
$ wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -

$ echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list

# ìš°ë¶„íˆ¬ ì„œë²„ ì—…ë°ì´íŠ¸
$ sudo apt-get update

# ì„¤ì¹˜
$ sudo apt-get install -y mongodb-org

$ echo "mongodb-org hold" | sudo dpkg --set-selections
$ echo "mongodb-org-database hold" | sudo dpkg --set-selections
$ echo "mongodb-org-server hold" | sudo dpkg --set-selections
$ echo "mongodb-mongosh hold" | sudo dpkg --set-selections
$ echo "mongodb-org-mongos hold" | sudo dpkg --set-selections
$ echo "mongodb-org-tools hold" | sudo dpkg --set-selections

# êµ¬ë™
$ sudo systemctl start mongod

# ìƒíƒœ í™•ì¸
$ sudo systemctl status mongod
```


<br/>


### ë¡œì»¬ì— MongoDB Compass ì„¤ì¹˜í•´ì„œ EC2ì— ìˆëŠ” MongoDBì™€ ì—°ê²°í•˜ê¸°
```SQL
-- ìœ ì € ìƒì„±
db.createUser(
  {
    user: "j7c204",
    pwd: "seveneleven", 
    roles: [
      { role: "userAdminAnyDatabase", db: "admin" },
      { role: "readWriteAnyDatabase", db: "admin" }
    ]
  }
)

-- ì…§ë‹¤ìš´
db.adminCommand( { shutdown: 1 } )
```

<br/>

```shell
# ì„¤ì • íŒŒì¼ê³ ì¹˜ê¸°
$ sudo vi /etc/mongod.conf

# ì´ë ‡ê²Œ ê³ ì¹˜ê¸°
security:
  authorization: enabled

# ë‹¤ì‹œ ì‹œì‘
$ sudo systemctl stop mongod
$ systemctl start mongod

# í¬íŠ¸ ì—´ì–´ì£¼ê¸°
$ sudo ufw allow 27017

# ì„¤ì • íŒŒì¼ ê³ ì¹˜ê¸°
$ sudo vi /etc/mongod.conf

# bindIP ë³€ê²½
# network interfaces
net:
  port: 27017
  bindIp: 0.0.0.0
#  bindIp: 127.0.0.1

# ë‹¤ì‹œ ì •ì§€ í›„ ì‹œì‘
$ sudo systemctl stop mongod
$ sudo systemctl start mongod
```

<br/><br/><br/>
### MySQL ì„¤ì¹˜ ë° ì„¸íŒ…

```shell
# ìš°ë¶„íˆ¬ ì„œë²„ ì—…ë°ì´íŠ¸
$ sudo apt-get update

# ì„¤ì¹˜
$ sudo apt-get install mysql-server

# êµ¬ë™
$ sudo systemctl start mysql.service
```

<br/>

```shell
# MySQL ì ‘ì†
$ sudo mysql

# í˜„ì¬ mysqlì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì„¸íŒ…ë˜ì–´ìˆëŠ” ìœ ì € í™•ì¸
mysql> SELECT user,authentication_string,plugin,host FROM mysql.user;
```


<br/>

```bash
# DBì— ì™¸ë¶€ ì ‘ì†í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ ê³„ì • ìƒì„± (% : ì–´ë–¤ ipë¡œë„ ì ‘ì† ê°€ëŠ¥í•˜ë„ë¡ í•˜ê¸° ìœ„í•¨)
mysql> CREATE USER 'ê³„ì •ì´ë¦„'@'%' IDENTIFIED BY 'ë¹„ë°€ë²ˆí˜¸';

# ê¶Œí•œ ë¶€ì—¬
mysql> GRANT ALL PRIVILEGES ON *.* TO 'ê³„ì •ì´ë¦„'@'%' WITH GRANT OPTION;

mysql> FLUSH PRIVILEGES;
```

<br/>

### ë¡œì»¬ì— MySQL Workbench ì„¤ì¹˜í•´ì„œ EC2ì— ìˆëŠ” MySQL ì—°ê²°í•˜ê¸°

```shell
# ì™¸ë¶€ ì ‘ì† í—ˆìš© ì„¤ì •
$ cd /etc/mysql/mysql.conf.d
$ vi mysqld.cnf
```

<br/>
- i ëˆŒëŸ¬ì„œ ì…ë ¥ ëª¨ë“œë¡œ ë³€ê²½ í›„ bind-address ë¥¼ 0.0.0.0 ìœ¼ë¡œ ìˆ˜ì • í›„ ì €ì¥í•˜ê³  ë‚˜ê°€ê¸°


<br/>

```shell
# EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ 3306 í¬íŠ¸ ì—´ê¸°
$ sudo ufw allow 3306

# MySQL ì¬ì‹œì‘
$ sudo systemctl restart mysql.service
```

<br/>

- Workbenchë¡œ ì´ë™

    - Connection Name: í•˜ê³  ì‹¶ì€ Connection ëª…
    - SSH Hostname: ì ‘ì†í•  ë„ë©”ì¸ ë„¤ì„ì´ë‚˜ IP
    - SSH Key File: ì¸ì¦í‚¤
    - Username: ì´ˆë°˜ì— ìƒì„±í•œ MySQL Username

<br/><br/><br/>

## Backend ë°°í¬ - Spring Boot
- .jar íŒŒì¼ì´ ìˆëŠ” ìœ„ì¹˜ì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰

```shell
$ java -jar <.jar íŒŒì¼ ì´ë¦„>.jar & # &ëŠ” ë°°ê²½ì—ì„œ ì„œë²„ê°€ ëŒì•„ê°€ê²Œë” í•´ì¤Œ
```

<br/><br/><br/>

## Frontend ë°°í¬ - React
```shell
# EC2 ì„œë²„ì— node.jsì™€ npm ì„¤ì¹˜
$ sudo apt update
$ sudo apt install nodejs
$ sudo apt install npm

# react ë””ë ‰í† ë¦¬ë¡œ ì´ë™ í›„ ì‹¤í–‰
$ npm i
$ npm run build
$ npm start
```

<br/><br/><br/>


## NginX ì„¤ì¹˜
```shell
# ì„¤ì¹˜
$ sudo apt install nginx

# nginx ì‹œì‘
$ sudo service nginx start

# nginx status í™•ì¸
$ sudo service nginx status
```


<br/>

- nginxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 80í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ 80í¬íŠ¸ ì—´ì–´ì£¼ê¸°

```shell
$ sudo ufw allow 80
```

<br/>

- default ì„¤ì • íŒŒì¼ì— ë“¤ì–´ê°€ì„œ í”„ë¡œì íŠ¸ì— ë§ëŠ” í™˜ê²½ì„¤ì •
```shell
$ sudo vi /etc/nginx/sites-available/default
```


<br/>

- ì„¤ì • ë³€ê²½ í›„ synxax ê²€ì‚¬í•˜ê³  NginX ì¬ì‹œì‘
```shell
$ sudo nginx -t
$ sudo systemctl restart nginx
```

<br/><br/><br/>

## SSL ì ìš©
```shell
# letsencrypt ì„¤ì¹˜
$ sudo apt-get update
$ sudo apt-get install letsencrypt

# NginX ì¤‘ì§€ (80 í¬íŠ¸ ì‚¬ìš© ì‹œ ì—ëŸ¬ë‚  ìˆ˜ ìˆìŒ)
$ sudo systemctl stop nginx

# ì¸ì¦ì„œ ë°œê¸‰
$ sudo letsencrypt certonly --standalone -d [ë„ë©”ì¸ ë„¤ì„]

# ì •ìƒ ë°œê¸‰ ì‹œ /etc/letsencrypt/live/[ë„ë©”ì¸ ë„¤ì„] í´ë” ì•ˆì— í‚¤ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ
# ex) fullchain.pem, privkey.pem
```

<br/>

- NginX ì„¤ì • íŒŒì¼ ìˆ˜ì •, Proxy ì„¤ì •(c111 ëŒ€ì‹  c204 ì…ë ¥í•˜ê³  íŒŒì¼ êµ¬ì¡°ë‚˜ ìœ„ì¹˜ëŠ” ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)

![image](/uploads/a1f2bbded013758abc7fc240c4a3c518/image.png)


<br/>

- NginX ê°€ë™

```shell
$ sudo systemctl start nginx
```

<br/><br/><br/>


